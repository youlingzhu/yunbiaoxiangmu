
	
#{extends 'LatoWebDelegate/mainServicesList.html' /}
#{set title:'升级本地应用空间配置' /}
#{set appInfo:'true' /}
#{set returnLinkLable:'返回应用空间列表' /}
#{set 'returnLink'}
javascript:history.go(-1)
#{/set}
#{set 'latoMainSide'}

<div class="lato-main-side localServer_appchange" >
     <!-- <div class="main_title_w main_title ">
        <h3>
            #{set title:'升级本地应用空间配置' /}<span lato-separator>&nbsp;</span>
        </h3>
        <a href="javascript:void(0)" onclick="history.go(-1)" class="list_back">返回</a>
          @{LatoWebDelegate.getLocalServerAppFormList(serviceCode,serverName)}
    </div>  -->
    
	 <div id="lato-main-side_a">
		
	
     </div>

	<form id="defaultForm" method="post" class="form-horizontal" action="@{LatoWebDelegate.putForm('changerLocalServerApp')}" >
		<input type="hidden" name="lato_server_code"  id="lato_server_code" value="${flash.服务器编号}" /> 
		<input type="hidden" name="lato_server_app_code"  id="lato_server_app_code" value="${flash.应用编号}" /> 
		<input type="hidden" name="lato_server_name"  id="lato_server_name" value="${flash.服务器名称}" /> 
		<input type="hidden" name="old_current_limit"  id="old_current_limit" value="${flash.并发数}" /> 
		<input type="hidden" name="old_template_limit"  id="old_template_limit" value="${flash.模板数}" /> 
		<input type="hidden" name="lato_buy_month"  id="lato_buy_month" value="" /> 
		
		<div class="main_body">
        <div class="col-md-9">
            <div class="body_name body_menu1 clearfix localServer_appchange_one">
                <label class="menu_names" id="menu_names">升级本地应用空间配置</label>
              </div>
                <div class="body_name body_menu1 clearfix localServer_appchange_two">
                    <label class=" menu_name">应用空间ID</label>
                    <label class="upgrade_text" name="lato_server_app_id" id="lato_server_app_id"> ${flash.空间ID}(${flash.空间名称})</label>
                 </div>
                 <div class="body_name body_menu1 clearfix">
                     <label class="menu_name">服务器名称</label>
                     <label class="upgrade_text" name="lato_server_name" id="lato_server_name">${flash.服务器名称}</label>
                 </div>
                  <div class="body_name body_menu1  form-group clearfix localServer_appchange">
				  <div class="clearfix">
                    <label class="menu_name">并发数</label>
                    <label class="upuser_text">${flash.并发数}</label>
                   <label class="zengjia">增加至</label>
                     <input class="upuser_text_1" name="lato_server_current_limit" id="lato_server_current_limit" onkeyup="alertProduct('lato_server_current_limit',this.value)" value="${flash.并发数}"></input>
                   <span class=" butt butt_user user_3" onclick="alertProduct('lato_server_current_limit',3)">3并发</span>
                   <span class=" butt butt_user user_5" onclick="alertProduct('lato_server_current_limit',5)">5并发</span>
                   <span class=" butt butt_user user_10" onclick="alertProduct('lato_server_current_limit',10)">10并发</span>
				    <span class=" butt butt_user user_10" onclick="alertProduct('lato_server_current_limit',50)">50并发</span>
                  </div> 
                 </div> 
				 
                 <div class="body_name body_menu1  form-group clearfix">
					 <div class="clearfix">
						  <label class="menu_name">模板数</label>
						  <label class="upuser_text">${flash.模板数}</label>
						  <label class="zengjia">增加至</label>
						   <input class="upuser_text_1" name="lato_template_number" id="lato_template_number" onkeyup="alertProduct('lato_template_number',this.value)" value="${flash.模板数}"></input>
						  <span class=" butt butt_template user_3" onclick="alertProduct('lato_template_number',60)">60模板</span>
						  <span class=" butt butt_template user_5" onclick="alertProduct('lato_template_number',100)">100模板</span>
						  <span class=" butt butt_template user_10" onclick="alertProduct('lato_template_number',150)">150模板</span>
						  <span class=" butt butt_template template_10" onclick="alertProduct('lato_template_number',200)">200模板</span>
					 </div>
				  </div>
				
				#{if "free".equals(flash.版本类型)}
                 <div class="body_name body_menu1 clearfix" >
                     <label class="menu_name">购买时长</label>
                    <div class="slider-date" id="slider-date-1">
                          <!--底层-->
                          <ul class="slider-bg clearfix">
                              <li>1</li>
                              <li>2</li>
                              <li>3</li>
                              <li>4</li>
                              <li>5</li>
                              <li>6</li>
                              <li>7</li>
                              <li>8</li>
                              <li>9</li>
                              <li>1年</li>
                              <li>2年</li>
                              <li>3年</li>
                              <li>10年</li>
                          </ul>
                      
                          <!--互动层-->
                         <div class="slider-bar">
                              <ul class="slider-bg clearfix">
                                  <li>1<span>1个月</span></li>
                                  <li>2<span>2个月</span></li>
                                  <li>3<span>3个月</span></li>
                                  <li>4<span>4个月</span></li>
                                  <li>5<span>5个月</span></li>
                                  <li>6<span>6个月</span></li>
                                  <li>7<span>7个月</span></li>
                                  <li>8<span>8个月</span></li>
                                  <li>9<span>9个月</span></li>
                                  <li>1年<span>1年</span></li>
                                  <li>2年<span>2年</span></li>
                                  <li>3年<span>3年</span></li>
                                  <li>10年<span>10年</span></li>
                              </ul>-->
                              <!--滑块按钮-->
                             <a href="javascript:;" class="slider-bar-btn"><i></i><i></i></a>
                         </div>
                         </div>
                 </div>
                  <div class="clearfix price_details localServer_appchange_jiage">
					 <p class="text_explain localServer_appchange_jiagezhe" id="text_free">购买一年以上立享9折</p> 
				 </div>
                 #{/if}

                   <div class=" body_name body_menu1 clearfix upgrade_btn">
				   <p class="cost_prompt">原价<s class="cost_price" id="cost_price"></s><span class="save_price" >立省￥<span id="save_price"></span></sapn></p>
					  <!--<label class="tishi">*如果已过期请先续费再升级</label>-->
                      <label class="pay">总费用：<b><span id="productPrice" name="productPrice"> </span> </b></label>
                <button type="submit" class="btn btn-spacepay" id="btnSuccess" data-dismiss="modal">确认支付</button>
                  </div>
                   <div class="pay_prompt">
                     <p class="pay_tishi" id="prompt_msg"  name="prompt_msg"></p>
                     </div>
     </div>         
    </div>
	
	</div>
        <!-- :form -->
  
	


<script type="text/javascript">

function updateButtonState(){
	
	$('#defaultForm').bootstrapValidator('disableSubmitButtons', false);  
	
	}

function alertProduct(idName,limit){
	 $( "#"+idName ).val( limit );
	queryMoney();
	$('#defaultForm').data('bootstrapValidator').updateStatus(idName,'NOT_VALIDATED').validateField(idName);
}

function queryMoney(){
		 var formParam = $("#defaultForm").serialize();//序列化表格内容为字符串    
		 
			$.ajax({    
				type:'post',        
				url:'@{LatoWebDelegate.queryProductPrice("changeLocalServiceForm")}',    
				data:formParam,    
				cache:false,    
				dataType:'json',    
				success:function(data){  
					
					var error = data.error;
					if(error.length > 0)
						document.getElementById('prompt_msg').innerText=error;
					else{
						document.getElementById('cost_price').innerText="￥"+data.原价;
						document.getElementById('save_price').innerText=ForDight(data.原价 - data.总费用,2);
						document.getElementById('productPrice').innerText=data.总费用;
					}
						
				}    
			});    
	}
	


(function($) {
    $.fn.sliderDate = function(setting) {
        var defaults = {
                callback: false //默认回调函数为false
            }
        //如果setting为空，就取default的值
        var setting = $.extend(defaults, setting);
        this.each(function() {
            //插件实现代码 
            //var $sliderDate = $(".slider-date");
            var $sliderDate = $(this);
			var $sliderBar = $sliderDate.find(".slider-bar");
			var $sliderBtn = $sliderDate.find(".slider-bar-btn");
			var liWid = 50+1; //单个li的宽度

			//滚动指定的位置
			var sliderToDes = function(index){

				//最大不能超过11
				if(index > 12){
					index = 12;
				}

				//最小不能小于 0 
				if(index < 0){
					index = 0;
				}

				//背景动画
				$sliderBar.animate({
					"width" : liWid*(index+1)
				},500);

				//执行回调
				if(setting.callback){
					setting.callback(index);
				}

			};

			//点击 - 滚动到指定位置
			$sliderDate.on('click', "li", function(e) {
				//执行滚动方法
				sliderToDes($(this).index());
			});
			
			//默认为1个月
			sliderToDes(0);
			
			//拖动 - 滚动到指定位置
			$sliderBtn.on('mousedown', function(e) {
				var $this = $(this);
				var pointX = e.pageX - $this.parent().width();
				var wid = null;

				//拖动事件
				$(document).on('mousemove',function(ev){
					wid = ev.pageX - pointX
					if(wid > 20 && wid < 620){
						$sliderBar.css("width", wid);
					}
				}).on('mouseup',function(e){
					$(this).off('mousemove mouseup');
					var index = Math.ceil(wid/liWid) - 1;
					sliderToDes(index);
				});
			});
        });
    }
})(jQuery);

$(function(){
	if("${flash.版本类型}" == 'free'){
		document.getElementById('prompt_msg').innerText='当前由免费版本升级到云表365版';
        function a(index){
             var month = index +1;
            if(month == 10)
                month = 12;
            else if(month == 11)
                month = 24;
            else if(month == 12)
                month = 36;
            else if(month == 13)
                month = 120;
            $("#lato_buy_month").val(month);
            queryMoney();
        }
        $("#slider-date-1").sliderDate({callback:a});
        
	} else {
        queryMoney();
    }
});
	
 $(document).ready(function() {
	$('#sub-item-2').addClass('in');
	$('#sub-item-4').addClass('in');	
});

$('#defaultForm')
    .bootstrapValidator({
        message: 'This value is not valid',
        feedbackIcons: {
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            'lato_service_name': {
                validators: {
                    notEmpty: {
                        message: '服务器名称不能为空...'
                    }
                }
            },
            
            'lato_server_current_limit':{
                validators: {
                    notEmpty: {
                        message: '请填写并发数...'
                    },
                callback: {  
                     message: '不允许小于当前并发数',  
                     callback: function(value, validator) {
                        
                        if(parseInt($("#old_current_limit").val())>parseInt($("#lato_server_current_limit").val()))
                    return false;
                        else
                    return true;
                    
                     }  
                 
                },between: {
                        min: 1,
                        max: 50,
                        message: '并发数最小为1最大为50...'
                    }
                }
            
            },
            'lato_template_number':{
                validators: {
                    notEmpty: {
                        message: '请填写模板数...'
                    },
                    callback: {  
                     message: '不允许小于当前模板数',  
                     callback: function(value, validator) {
                        
                        if(parseInt($("#old_template_limit").val())>parseInt($("#lato_template_number").val()))
                    return false;
                        else
                    return true;
                    
                     }  
                 
                }
                }
            
            }
        }
    }).on('success.form.bv', function(e) {
        e.preventDefault();
         var params=$("form").serialize();
         $.ajax({
                url:"@{LatoWebDelegate.putForm('changerLocalServerApp')}",
                type:'POST',
                dataType:'json',
                data:params
                ,success:function(data){
                    if(null != data.errorCode && data.errorCode.length > 0)
                    {
                        showErrorModel("修改应用出现错误",data.errorMsg);
                        $("#defaultForm").data('bootstrapValidator').resetForm();
                    }else{
                        location.href = data.url;
                    }
                },
                beforeSend: function(xhr) {
                //	checkIsEversheetWeb(xhr);
                }
                ,error:function(XMLHttpRequest, textStatus, errorThrown){
                            var text = decodeURIComponent(XMLHttpRequest.responseText.replace(/\+/g, '%20'));
                            var text1 =	text.replace(/\r\n|\n|\r/g,'');
                            var va11 =	decodeURI(text1);
                            var val2="修改应用出现错误";
                            var dataObj=eval("("+va11+")");
                            
                            showErrorModel(val2,dataObj.message);
                            $("#defaultForm").data('bootstrapValidator').resetForm();
                    }
                }
            );
            
    })
    .on('error.field.bv', function(e, data) {
        //console.log('error.field.bv -->', data.element);
    })
    .on('success.field.bv', function(e, data) {
        //console.log('success.field.bv -->', data.element);
        
        
    })
    .on('added.field.bv', function(e, data) {
        //console.log('Added element -->', data.field, data.element);
    })
    .on('removed.field.bv', function(e, data) {
        //console.log('Removed element -->', data.field, data.element);
    });


    
   serverCode();
   function serverCode(){
		var latoMainSideA=document.getElementById('lato-main-side_a');
		var urlServerCode= window.location.href;
		var strCode='serviceCode';
		var indexCode=urlServerCode.indexOf(strCode);
		var nameServer=window.localStorage.getItem('nameServer');
		
			var urlServerName='${serverName}';
			if(encodeURIComponent(urlServerName)==encodeURIComponent(nameServer)){
				nameServer='[应用空间]'+nameServer;
				urlServerName='[服务器]'+urlServerName;
			};
        	latoMainSideA.innerHTML='<a href="@{LatoWebDelegate.getIndexForm()}" class="list_back_a">首页</a>'+
        	'<img src="@{'/public/images/vector38.png'}" >'+
				'<a href="@{LatoWebDelegate.getLocalServiceFormList()}" class="list_back_a">本地应用</a>'+
				'<img src="@{'/public/images/vector38.png'}" >'+
				'<a href="@{LatoWebDelegate.getLocalServerAppFormList(serviceCode,serverName)}" class="list_back_a">'+urlServerName+'</a>'+
				'<img src="@{'/public/images/vector38.png'}" >'+
				'<a href="@{LatoWebDelegate.getLocalServerApp(serviceCode,(serverAppId!=null?serverAppId:appId),(serverAppCode!=null?serverAppCode:appCode),serverName)}" class="list_back_a">'+nameServer+'</a>'+
				'<img src="@{'/public/images/vector38.png'}" >'+
				'<a href="@{LatoWebDelegate.getLocalServerApp(serviceCode,(serverAppId!=null?serverAppId:appId),(serverAppCode!=null?serverAppCode:appCode),serverName)}" class="list_back_a">应用空间详情</a>'+
				'<img src="@{'/public/images/vector38.png'}" >'+
				'<a href="javascript:;" id="reloadPages" class="list_back_a">升级</a>'
        
   }

    $('#reloadPages').click(function(){
		window.history.go(0)
	})





</script>


<style>

    .main_body .body_menu1 {
        margin-top: 14px;
        margin-bottom: 6px;
    }
    .menu_names{
        font-size: 14px;
        color:#373F4A;
        margin-bottom: 6px;
        font-weight: 700;
        width: 300px;
        font-family: Microsoft YaHei;
    }

    .menu_name {
    color: rgba(55, 63, 74, 0.6);
    text-align: left;
    width: 94px;
    height: 20px;
    float: left;
    line-height: 31px;
}

.upgrade_text {
    background: #ffffff;
  
}
 #slider-date-1{
    margin-left: 9px;
 } 

 .upuser_text {
    background: #ffffff;
   
}

#btnSuccess{
	border: none;
	outline:none;
	color: #fff;
}
button.btn{
	border: none;
	outline:none;
	color: #fff;
}
#btnSuccess:hover{
	color: #fff;
	background-color: rgb(78,213,131);
}
#btnSuccess:active{
	color: #fff;
	background-color: rgb(69,191,102);
}

.main_body {
    padding-left: 0px;
    margin-left: -12px;
}
.cost_prompt{
    text-align: right;
}

.pay_prompt{
    right: 1px;
}
.pay_prompt p {
    /* margin-top: 21px; */
    font-size: 10px;
    color: #FB5040;
    display: block;
    font-weight: 400;
    position: absolute;
    left: -576px;
    top: -14px;
}


.form-group .help-block{
    margin-left: 252px;
}


 </style>

#{/set}